<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<style>
    .area {
        fill: steelblue;
        clip-path: url(#clip);
    }
    .axis line{
        fill:none;
        stroke: black;
        shape-rendering: crispEdges;
    },
    .axis text{
        font: 10px Georgia;
    }
</style>
<link href="./css/style2.css" rel="stylesheet" type="text/css">
    <div id="content">
        <div class="inside">
            <img src="./1st project/whiteband.png" , alt>
            <h1>Regular Visualization</h1>
            <h2>Brush the time-period data</h2>
            <p>This visualization is aim to present the regular time-period data, the data must include one attribute date, and the other attribute or attributes will be quantitative data. The following visualization realizes the zoom function</p>
            <div id="brush"></div>
            <h2>Stapplot from random data</h2>
            <div id="stap"></div>
            <svg heigh = "300" width = auto></svg>
        </div>
    </div>
<script type="text/javascript">
    var width = 960,
        height= 500,
        margin= 30,
        width_brush = width - margin - margin,
        height_brush= height- margin - margin;

    var svg1 = d3.select("#brush").append("svg").attr("width",width).attr("height",height).style("display","block").style("margin","auto");

    var parseDate = d3.timeParse("%b %Y");

    var x = d3.scaleTime().range([0,width_brush]),
        y = d3.scaleLinear().range([height_brush,0]);

    var xAxis = d3.axisBottom(x),
        yAxis = d3.axisLeft(y);

    var zoom = d3.zoom().scaleExtent([1,32]).translateExtent([[0,0],[width_brush,height_brush]]).extent([[0,0],[width_brush,height_brush]]).on("zoom",zoomed);

    var area = d3.area().curve(d3.curveMonotoneX).x(function(d){return x(d.date)}).y0(height_brush).y1(function(d){return y(d.price)});

    svg1.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width", width_brush).attr("height", height_brush);

    var g1 = svg1.append("g").attr("width",width_brush).attr("height",height_brush).attr("transform","translate(40,"+ margin +")");

    d3.csv("sp500.csv",type,function(error,data){
        if (error) throw error;

        x.domain(d3.extent(data,function(d){return d.date}));
        y.domain([0,d3.max(data,function(d){return d.price})]);

        g1.append("path").datum(data).attr("class","area").attr("d",area);

        g1.append("g").attr("class","axis axis--x").attr("transform","translate(0," + height_brush + ")").call(xAxis);

        g1.append("g").attr("class","axis axis--y").call(yAxis);

        var d0 = new Date(2005,0,1),
            d1 = new Date(2008,0,1);

        svg1.call(zoom).transition().duration(750).call(zoom.transform, d3.zoomIdentity.scale(width_brush / (x(d1)-x(d0))).translate(-x(d0),0));

    });

    function zoomed() {
        var xt = d3.event.transform.rescaleX(x);

        g1.select(".area").attr("d",area.x(function(d){return xt(d.date)}));

        g1.select(".axis--x").call(xAxis.scale(xt));
    }

    function type(d) {
        d.date  = parseDate(d.date);
        d.price = +d.price;
        return d;
    }

    var svg2 = d3.select("#stap").append("svg").attr("width",width).attr("height",height).style("display","block").style("margin","auto");

    var dataset = [];
    var numDataPoints = 50;
    var xRange = Math.random() * 1000;
    var yRange = Math.random() * 1000;
    for (var i = 0; i < numDataPoints; i++) {
        var newNumber1 = Math.round(Math.random() * xRange);
        var newNumber2 = Math.round(Math.random() * yRange);
        dataset.push([newNumber1, newNumber2]);
    }

    var xScale = d3.scaleLinear().domain([0,d3.max(dataset,function(d){return d[0]})]).range([0,width_brush]),
        yScale = d3.scaleLinear().domain([0,d3.max(dataset,function(d){return d[1]})]).range([height_brush,0]),
        rScale = d3.scaleLinear().domain([0,d3.max(dataset,function(d){return d[1]})]).range([2,10]);

    var Axisx = d3.axisBottom(xScale),
        Axisy = d3.axisLeft(yScale);

    var g2 = svg2.append("g").attr("width",width_brush).attr("height",height_brush).attr("transform","translate(40,"+ margin +")");

    g2.append("g").attr("class","axis").attr("transform","translate(0," + height_brush + ")").call(Axisx);
    g2.append("g").attr("class","axis").call(Axisy);

    appendcircle();

    svg2.on("click", function(){
        var coords = d3.mouse(this);
        var newData = [Math.round(xScale.invert(coords[0]-40)), Math.round(yScale.invert(coords[1]-30))];
        dataset.push(newData);
        appendcircle();
    })

    function appendcircle(){
        g2.selectAll("circle").data(dataset).enter().append("circle").attr("cx",function(d){return xScale(d[0])}).attr("cy",function(d){return yScale(d[1])}).attr("r",function(d){return rScale(d[1])}).on("mouseover",function(d){
            d3.select(this).attr("fill","orange").attr("stroke","orange").attr("stroke-width","5");
            d3.select(this).append("text").attr("x",function(d){return xScale(d[0])-30}).attr("y",function(d){return yScale(d[1])-15}).text(function(d){return [d[0],d[1]]});
        }).on("mouseout",function(){
            d3.select(this).attr("fill", "black").attr("r", function(d){return rScale(d[1])}).attr("stroke","none");
        }).append('title').text(function(d){return d[0]+","+d[1]});
    }
</script>

</html>